# 2. フォーマッタを有効にする

## `prettier` をインストールする

```bash
npm install -D prettier
```

## `prettier` を設定する

```text :no-line-numbers
my-project
 + dist
 + node_modules
 + src
 + .prettierignore   // [!code ++]
 + .prettierrc       // [!code ++]
 + package-lock.json
 + package.json
 + tsconfig.json
```

### `.prettierrc`の作成

```json
{
    "printWidth": 80,
    "tabWidth": 4,
    "useTabs": false,
    "semi":true,
    "singleQuote": true,
    "trailingComma": "es5",
    "bracketSpacing": false
}
```

| プロパティ名     | 内容                                                       | デフォルト値 |
| ---------------- | ---------------------------------------------------------- | ------------ |
| `printWidth`     | コードの幅を指定する。                                     | `80`         |
| `tabWidth`       | タブの幅を指定する。                                       | `2`          |
| `useTabs`        | タブでインデントを行うかどうかを指定する。                 | `false`      |
| `semi`           | セミコロンを末尾に追加するかどうかを指定する。             | `true`       |
| `singleQuote`    | シングルクォーテーションで文字列を囲むかどうかを指定する。 | `true`       |
| `trailingComma`  | 文字列の末尾にカンマを追加するかどうかを指定する。         | `es5`        |
| `bracketSpacing` | ブレース内のスペースを追加するかどうかを指定する。         | `true`       |

### `.prettierignore`の作成

```text
dist
node_modules
.prettierrc
.prettierignore
package-lock.json
package.json
```

## 試しに実行してみる

### 未フォーマットなファイルを作成してみる

```text :no-line-numbers
my-project              // [!code focus]
 + ...
 + node_modules
 + src                  // [!code focus]
 |  + unformatted.ts    // [!code focus] // [!code highlight]
 + .prettierignore
 + ...
```

```ts
function someHeavyAction(arg1: string): Promise<number>{
const randNumber = Math.random();
return new Promise(   (resolve)=>{
    console.log('run start:' + arg1)
    setTimeout(()=>{
        console.log("finish:" + arg1)
        resolve(randNumber);
    }, 1000*randNumber);
    })
}
export function runSomeAction(
someArguments: string[])
: Promise<number[]>{
    const resultPromises = someArguments.map(arg =>{
        return someHeavyAction(arg)
    });return Promise.all(resultPromises);
}
```

### フォーマットチェックをする

```bash
npx prettier . --check
```

```bash
Checking formatting...
[warn] bundle.mjs
[warn] src/unformatted.ts
[warn] tsconfig.json
[warn] Code style issues found in 3 files. Run Prettier with --write to fix.
```

### フォーマットの自動修正をする

```bash
npx prettier src --write
```

::: tabs

@tab 修正前

```ts
function someHeavyAction(arg1: string): Promise<number>{
const randNumber = Math.random();
return new Promise(   (resolve)=>{
    console.log('run start:' + arg1)
    setTimeout(()=>{
        console.log("finish:" + arg1)
        resolve(randNumber);
    }, 1000*randNumber);
    })
}
export function runSomeAction(
someArguments: string[])
: Promise<number[]>{
    const resultPromises = someArguments.map(arg =>{
        return someHeavyAction(arg)
    });return Promise.all(resultPromises);
}
```

@tab 修正後

```ts
function someHeavyAction(arg1: string): Promise<number> {
    const randNumber = Math.random();
    return new Promise((resolve) => {
        console.log('run start:' + arg1);
        setTimeout(() => {
            console.log('finish:' + arg1);
            resolve(randNumber);
        }, 1000 * randNumber);
    });
}
export function runSomeAction(someArguments: string[]): Promise<number[]> {
    const resultPromises = someArguments.map((arg) => {
        return someHeavyAction(arg);
    });
    return Promise.all(resultPromises);
}
```

:::

## `scripts`の追加

## Visual Studio Code の拡張機能を使って実行

<VPCard
  title="Prettier - Code formatter"
  link="https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode"
  image="https://esbenp.gallerycdn.vsassets.io/extensions/esbenp/prettier-vscode/11.0.0/1723648421534/Microsoft.VisualStudio.Services.Icons.Default"
  description="Code formatter using prettier"
/>

```text :no-line-numbers
my-project              // [!code focus]
 + .vscode// [!code focus]
 |  + setting.json    // [!code focus] // [!code highlight]
 + dist
 + node_modules
 + src
 + ...
```


```json
{
    "editor.formatOnSave": true,
    "editor.defaultFormatter": "esbenp.prettier-vscode"
}
```
